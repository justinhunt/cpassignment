{"version":3,"sources":["../src/activitycontroller.js"],"names":["define","$","jqui","log","recorderhelper","dialogs","templates","Ajax","notification","debug","cmid","activitydata","recorderid","successmessageid","sorryboxid","controls","moduleclass","selectedattempt","graded","clone","extend","init","props","dd","theid","widgetid","configcontrol","get","JSON","parse","value","remove","startbuttonid","is_browser_ok","show","setup_recorder","process_html","register_events","opts","finishedcontainer","errorcontainer","recordingcontainer","recordercontainer","instructionscontainer","startbuttoncontainer","myattemptscontainer","myattemptslabel","currentfeedbackcontainer","attemptstatuscontainer","startbutton","selectattemptbutton","update_attempt_table","dosummarylayout","beginall","m","passagerecorded","navigator","mediaDevices","getUserMedia","on_recording_start","on_recording_end","on_audio_processing","eventdata","send_submission","mediaurl","dofinishedlayout","click","dorecordinglayout","select_attempt","attr","attemptid","call","methodname","args","that","done","ajaxresult","payloadobject","success","openModal","message","fail","exception","selectedattemptid","submitlabel","M","util","get_string","text","therow","find","trigger","insert_new_attempt","record","render","then","html","id","append","filename","newattempt","mediafile","timecreated","status","grade_p","hide","doerrorlayout"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery','jqueryui', 'core/log','mod_cpassignment/recorderhelper','mod_cpassignment/dialogs','core/templates','core/ajax','core/notification'],\n    function($, jqui, log, recorderhelper,dialogs,templates, Ajax, notification) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Activity controller: initialising');\n\n    return {\n\n        cmid: null,\n        activitydata: null,\n        recorderid: null,\n        successmessageid: null,\n        sorryboxid: null,\n        controls: null,\n        moduleclass: null,\n        selectedattempt: 0,\n        graded: false,\n\n        //for making multiple instances\n        clone: function(){\n            return $.extend(true,{},this);\n        },\n\n        //init the activity page js and components\n        init: function(props){\n            var dd = this.clone();\n\n            //pick up opts from html\n            var theid='#amdopts_' + props.widgetid;\n            var configcontrol = $(theid).get(0);\n            if(configcontrol){\n                dd.activitydata = JSON.parse(configcontrol.value);\n                $(theid).remove();\n            }else{\n                //if there is no config we might as well give up\n                log.debug('Read Aloud Test Controller: No config found on page. Giving up.');\n                return;\n            }\n\n            dd.moduleclass = dd.activitydata.moduleclass;\n            dd.cmid = props.cmid;\n            dd.recorderid = dd.activitydata.recorderid;\n            dd.sorryboxid = \"sorryboxid-would-go-here\"//props.widgetid + '_sorrybox';\n            dd.successmessageid = dd.moduleclass  + '_uploadsuccess';\n            dd.startbuttonid = dd.moduleclass  + '_startbutton';\n            dd.selectedattempt = dd.activitydata.selectedattempt;\n            dd.graded = dd.activitydata.graded;\n\n\n            //if the browser doesn't support html5 recording.\n            //then warn and do not go any further\n            if(!dd.is_browser_ok()){\n                $('#' + dd.sorryboxid).show();\n                return;\n            }\n\n            dd.setup_recorder();\n            dd.process_html(dd.activitydata);\n            dd.register_events();\n        },\n\n\n\n        process_html: function(opts){\n\n            var controls ={\n\n                finishedcontainer: $('.' +  opts['finishedcontainer']), //the text showed after finish\n                errorcontainer: $('.' +  opts['errorcontainer']), //any errors\n                recordingcontainer: $('.' +  opts['recordingcontainer']), //the recorder container\n                recordercontainer: $('.' +  opts['recordercontainer']),  //the recorder container\n                instructionscontainer: $('.' +  opts['instructionscontainer']), //the activity instructions container\n                startbuttoncontainer: $('.' +  opts['moduleclass'] + '_startbuttoncontainer'),  //the start button container\n                myattemptscontainer: $('.' +  opts['moduleclass'] + '_myattempts_cont'),  //the attempt data (current submission) container\n                myattemptslabel: $('.' +  opts['moduleclass'] + '_myattempts_caption'),\n                currentfeedbackcontainer: $('.' +  opts['moduleclass'] + '_current_feedback_cont'), // //the feedback container\n                attemptstatuscontainer: $('.' +  opts['moduleclass'] + '_attempt_status_cont'), //the attempt status message containter\n                startbutton: $('#' +  opts['moduleclass'] + '_startbutton'), //the start button\n                selectattemptbutton: $('.' +  opts['moduleclass'] + '_selectattempt') //the select attempt button\n            };\n            this.controls = controls;\n\n            //init attempts table\n            if(!this.graded){\n\n                this.update_attempt_table(this,this.selectedattempt);\n            }\n\n            switch(opts['pagemode']){\n                case 'summary':\n                    this.dosummarylayout();\n                    break;\n                case 'attempt':\n                default:\n\n            }\n        },\n\n\n\n        beginall: function(){\n            var m = this;\n           // m.dorecord();\n            m.passagerecorded = true;\n        },\n\n        is_browser_ok: function(){\n            return (navigator && navigator.mediaDevices\n                && navigator.mediaDevices.getUserMedia);\n        },\n\n        setup_recorder: function(){\n            var dd = this;\n\n            //Set up the callback functions for the audio recorder\n\n            //originates from the recording:started event\n            //See https://api.poodll.com\n            var on_recording_start= function(eventdata){\n                //do something\n            };\n\n            //originates from the recording:ended event\n            //See https://api.poodll.com\n            var on_recording_end= function(eventdata){\n                //do not do anything here\n            };\n\n            //data sent here originates from the awaiting_processing event\n            //See https://api.poodll.com\n           var on_audio_processing= function(eventdata){\n                //at this point we know the submission has been uploaded and we know the fileURL\n               //so we send the submission\n               dd.send_submission(eventdata.mediaurl);\n              //and let the user know that they are all done\n               dd.dofinishedlayout();\n            };\n\n            //init the recorder\n            recorderhelper.init(dd.activitydata,\n                on_recording_start,\n                on_recording_end,\n                on_audio_processing);\n        },\n\n        register_events: function() {\n            var dd = this;\n\t\t\t//events for other controls on the page\n            //ie not recorders\n            dd.controls.startbutton.click(function(){\n                    dd.dorecordinglayout();\n                }\n            );\n\n            dd.controls.selectattemptbutton.click(function(){\n                    dd.select_attempt($(this).attr('data-attemptid'));\n                }\n            );\n        },\n\n        select_attempt: function(attemptid){\n\n\n            Ajax.call([{\n                methodname: 'mod_cpassignment_select_attempt',\n                args: {\n                    cmid: that.cmid,\n                    attemptid: attemptid\n                },\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch(payloadobject.success) {\n                            case true:\n                                that.update_attempt_table(that,attemptid);\n                                that.selectedattempt = attemptid;\n                                dialogs.openModal('#' + that.successmessageid);\n                                break;\n\n                            case false:\n                            default:\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n\n        },\n\n        update_attempt_table: function(that,selectedattemptid){\n            //because of a jquery quirk with data attributes, this selector don't work\n           // that.controls.selectattemptbutton.find(\"[data-attemptid='\" + selectedattemptid  + \"']\").hide();\n            //this works but its not needed any more [can be removed]  we only have one button\n          //  $('.' +  this.moduleclass + '_selectattempt[data-attemptid=' + selectedattemptid + ']').hide();\n\n\n            //need to update selected row's status here ...\n            var submitlabel = M.util.get_string('submitted','mod_cpassignment');\n           $('.mod_cpassignment_cell_attempts_status').text('');\n           var therow = $('.' +  this.moduleclass + '_attemptrow[data-attemptid=' + selectedattemptid + ']');\n           therow.find('.mod_cpassignment_cell_attempts_status').text(submitlabel);\n           //trigger the click event. hate doing this ...\n            therow.trigger(\"click\");\n        },\n\n        insert_new_attempt: function(that,record){\n\n            templates.render('mod_cpassignment/attemptrow',record).then(\n                function(html,js){\n                    that.selectedattempt = record.id;\n                    that.controls.myattemptscontainer.find('tbody').append(html);\n                    that.update_attempt_table(that,record.id);\n\n                }\n            );\n        },\n\n        send_submission: function(filename){\n            var that=this;\n\n            Ajax.call([{\n                methodname: 'mod_cpassignment_submit_attempt',\n                args: {\n                    filename: filename,\n                    cmid: that.cmid\n                },\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch(payloadobject.success) {\n                            case true:\n                                var record = {};\n                                record.id=payloadobject.newattempt.id;\n                                record.mediafile=filename;\n                                record.timecreated=payloadobject.newattempt.timecreated;\n                                record.status='';\n                                record.grade_p=0;\n                                that.insert_new_attempt(that,record);\n\n                                dialogs.openModal('#' + that.successmessageid);\n                                break;\n\n                            case false:\n                            default:\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n\n        },\n\n\n        dorecordinglayout: function(){\n            var m = this;\n            m.controls.instructionscontainer.show();\n            m.controls.startbuttoncontainer.hide();\n            m.controls.myattemptscontainer.hide();\n            m.controls.myattemptslabel.hide();\n            m.controls.attemptstatuscontainer.hide();\n            m.controls.currentfeedbackcontainer.hide();\n            m.controls.recordingcontainer.show();\n        },\n\n\n        dosummarylayout: function(){\n            var m = this;\n            m.controls.instructionscontainer.show();\n            m.controls.recordingcontainer.hide();\n            m.controls.finishedcontainer.hide();\n            m.controls.startbuttoncontainer.show();\n            m.controls.myattemptscontainer.show();\n            m.controls.myattemptslabel.show();\n            m.controls.attemptstatuscontainer.show();\n            m.controls.currentfeedbackcontainer.show()\n\n        },\n\n        dofinishedlayout: function(){\n            var m = this;\n            m.controls.instructionscontainer.hide();\n            m.controls.recordingcontainer.hide();  // don't need any more.\n            m.controls.finishedcontainer.show();\n            m.controls.startbuttoncontainer.hide();\n            m.controls.myattemptscontainer.show();\n            m.controls.myattemptslabel.show();\n            m.controls.attemptstatuscontainer.show();\n            m.controls.currentfeedbackcontainer.hide();\n\n        },\n        doerrorlayout: function(){\n            var m = this;\n            //m.controls.passagecontainer.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.errorcontainer.show();\n            m.controls.startbuttoncontainer.hide();\n            m.controls.myattemptscontainer.hide();\n            m.controls.myattemptslabel.hide();\n            m.controls.attemptstatuscontainer.hide();\n            m.controls.currentfeedbackcontainer.hide();\n        }\n    };//end of returned object\n});//total end\n"],"file":"activitycontroller.min.js"}