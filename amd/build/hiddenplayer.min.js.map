{"version":3,"sources":["../src/hiddenplayer.js"],"names":["define","$","log","dialogs","debug","controls","mediatype","overallcontainer","hiddenplayer","hiddenplayerbutton","hiddenvideoplayer","videoplayercontainer","activebutton","activebuttonpaused","activebuttonplaying","init","opts","register_controls","register_events","that","audioplayer","on","mediasrc","attr","dohiddenvideoplay","prop","dohiddenstop","dohiddenaudioplay","m","pause","load","pp","play","then","catch","dobuttonicons","videoplayer","openModal","theaudiosrc","each","audiosrc","addClass","removeClass"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log','mod_cpassignment/dialogs'], function($,log,dialogs) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('cpassignment hidden player: initialising');\n\n    return {\n\n        controls: {},\n        mediatype: null,\n        overallcontainer: 'mod_cpassignment_attempts_cont',\n        hiddenplayer: 'mod_cpassignment_hidden_player',\n        hiddenplayerbutton: 'mod_cpassignment_hidden_player_button',\n        hiddenvideoplayer: 'mod_cpassignment_hidden_video_player',\n        videoplayercontainer: 'mod_cpassignment_hiddenvideocontainer',\n        activebutton: 'mod_cpassignment_hidden_player_button_active',\n        activebuttonpaused: 'mod_cpassignment_hidden_player_button_paused',\n        activebuttonplaying: 'mod_cpassignment_hidden_player_button_playing',\n\n        init: function (opts) {\n            this.mediatype = opts['mediatype'];\n            this.hiddenplayer = opts['hiddenplayerclass'];\n            this.hiddenplayerbutton = opts['hiddenplayerbuttonclass'];\n            this.register_controls();\n            this.register_events();\n        },\n\n        register_controls: function(){\n            this.controls.overallcontainer = $('.' + this.overallcontainer);\n            this.controls.hiddenplayer = $('.' + this.hiddenplayer);\n            this.controls.hiddenvideoplayer = $('.' + this.hiddenvideoplayer);\n            this.controls.hiddenplayerbutton = $('.' + this.hiddenplayerbutton);\n        },\n\n        register_events: function(){\n            var that = this;\n            var audioplayer = this.controls.hiddenplayer;\n            //handle the button click\n           // this.controls.overallcontainer.on('click','.' + this.hiddenplayerbutton, function(e){\n            $('body').on('click','.' + this.hiddenplayerbutton, function(e){\n                switch(that.mediatype){\n\n                    case 'video':\n                        var mediasrc = $(this).attr('data-audiosource');\n                        that.dohiddenvideoplay(mediasrc);\n                        break;\n\n                    case 'audio':\n                    default:\n                        var mediasrc = $(this).attr('data-audiosource');\n                        if (mediasrc == audioplayer.attr('src') && !(audioplayer.prop('paused'))) {\n                            that.dohiddenstop();\n                        } else {\n                            that.dohiddenaudioplay(mediasrc);\n                        }\n                }\n\n            });\n\n        },\n\n\n        dohiddenaudioplay: function (mediasrc) {\n            var m = this;\n            var audioplayer = m.controls.hiddenplayer;\n            audioplayer.attr('src', mediasrc);\n            audioplayer[0].pause();\n            audioplayer[0].load();\n            var pp = audioplayer[0].play();\n            if (pp !== undefined) {\n                pp.then(function() {\n                    // Yay we are playing\n                }).catch(function(error) {\n                    // somethings up ... but we can ignore it\n                });\n            }\n            m.dobuttonicons();\n        },\n\n        dohiddenvideoplay: function(mediasrc){\n\n            var m = this;//M.mod_cpassignment.gradinghelper;\n            var videoplayer = m.controls.hiddenvideoplayer;\n            videoplayer.attr('src', mediasrc);\n            videoplayer[0].pause();\n            videoplayer[0].load();\n            var pp = videoplayer[0].play();\n            if (pp !== undefined) {\n                pp.then(function() {\n                    // Yay we are playing\n                }).catch(function(error) {\n                    // somethings up ... but we can ignore it\n                });\n            }\n            dialogs.openModal('#' + m.videoplayercontainer);\n            m.dobuttonicons();\n        },\n\n        dohiddenstop: function () {\n            var m = this;// M.mod_cpassignment.gradinghelper;\n            var audioplayer =  m.controls.hiddenplayer;\n            audioplayer[0].pause();\n            m.dobuttonicons();\n        },\n\n        dobuttonicons: function (theaudiosrc) {\n            var m = this;//M.mod_cpassignment.gradinghelper;\n            var audioplayer = m.controls.hiddenplayer;\n            if (!theaudiosrc) {\n                theaudiosrc = audioplayer.attr('src');\n            }\n            m.controls.hiddenplayerbutton.each(function (index) {\n                var audiosrc = $(this).attr('data-audiosource');\n                if (audiosrc == theaudiosrc) {\n                    $(this).addClass(m.activebutton);\n                    if (audioplayer.prop('paused')) {\n                        $(this).removeClass(m.activebuttonplaying);\n                        $(this).addClass(m.activebuttonpaused);\n                        //for now we make it look like no button is selected\n                        //later we can implement better controls\n                        $(this).removeClass(m.activebutton);\n                    } else {\n                        $(this).removeClass(m.activebuttonpaused);\n                        $(this).addClass(m.activebuttonplaying);\n                    }\n                } else {\n                    $(this).removeClass(m.activebutton);\n                    $(this).removeClass(m.activebuttonplaying);\n                    $(this).removeClass(m.activebuttonpaused);\n                }\n            });\n        }\n    };//end of return object\n\n});"],"file":"hiddenplayer.min.js"}